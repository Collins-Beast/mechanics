<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Selcting your location</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="css/bootstrap-4.3.1-dist/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="css/styles.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="js/scripts.js"></script>
    <title>Online mechanic finder</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* The Modal (background) */

        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            padding-top: 100px;
            /* Location of the box */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: #a314e6;
            /* Fallback color */
            background-color: rgba(224, 9, 153, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content */

        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: 1px solid #888;
            width: 80%;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */

        @-webkit-keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }

            to {
                top: 0;
                opacity: 1
            }
        }

        @keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }

            to {
                top: 0;
                opacity: 1
            }
        }

        /* The Close Button */

        .close {
            color: red;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-header {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }

        .modal-body {
            padding: 2px 16px;
        }

        .modal-footer {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }

        h4 {
            text-align: left;
        }

        #id01 {
            background-color: lightblue;
            color: black;
            text-align: center;
        }

        #id02 {
            background-color: white;
            color: black;
            padding: 40px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="inputs">
            <div class="row">
                <div class="col-12">
                    <h1>
                        <marquee>Find Our Mechanics</marquee>
                    </h1>
                    <form class="form1">
                        <div class="row">
                            <div class="col-3 logo11"></div>
                            <div class="col-6">
                                <p id="ser"></p>
                                <label><strong> Services:</strong></label>
                                <select required id="locationSelection">
                                    <option>--Select The Type Of Service--</option>
                                    <option id="Brake Repair" value="Brake Repair">Brake Repair</option>
                                    <option id="synthetic Oil change And Repair"
                                        value="synthetic Oil change And Repair">synthetic Oil
                                        change And Repair</option>
                                    <option id="Engine Transmission and mantainance"
                                        value="Engine Transmission and mantainance">Engine
                                        Transmission and mantainance</option>
                                    <option id="Heating and colling services" value="Heating and colling services">
                                        Heating and cooling
                                        services</option>
                                    <option id="Tire Repair" value="Tire Repair">Tire Repair</option>
                                    <option id="Electrical Faults and Repair" value="Electrical Faults and Repair">
                                        Electrical Faults and
                                        Repair</option>
                                    <option id="General Mantainance" value="General Mantainance">General Mantainance
                                    </option>
                                </select><br /><br />
                                <label><strong> Car Model:</strong></label>
                                <select required id="cars">
                                    <option id="model">--Select Your Car Model--</option>
                                    <option>Ford</option>
                                    <option id="toyota" value="Toyota">Toyota</option>
                                    <option id="nissan" value="Nissan">Nissan</option>
                                    <option id="volvo" value="Volvo">Volvo</option>
                                    <option id="range" value="Range Rover">Range Rover</option>
                                    <option id="bmw" value="BMW">Truck</option>
                                    <option id="mercedes" value="mercedes">Mercedes-Benz</option>
                                    <option id="suzuki" value="suzuki">Suzuki</option>
                                    <option id="subaru" value="subaru">Subaru</option>
                                    <option id="motorcycle" value="motorcycle">MotorCycle</option>
                                </select><br />
                                <br />
                                <form>
                                    <div class="form-group">
                                        <label for="comment" id="description">Write a Brief description of the
                                            problem(leave blank if not
                                            sure):</label>
                                        <textarea class="form-control" id="brief" class="input-group input-group-lg"
                                            style="font-size: 2rem; color:red; font-family: Arial, Helvetica, sans-serif;"
                                            rows="5" id="comment"></textarea>
                                    </div>
                                    <br>
                                    <button type="button" id="demo" class="btn m-3 btn-primary btn-lg"
                                        style="font-size: 1.5rem;" onclick="getLocation()">Click here
                                        for us to know your location</button>
                                    <div class="m-3" id='location-demo'></div>
                                    <button type="button" class="btn btn-primary" style="font-size: 1.5rem;"
                                        onclick=" revealMechanics() " <h4>Click to check
                                        available Mechanics.</h3></button>
                                </form>
                                <br /><br />
                            </div>
                            <div class=" col-3 logo22 "></div>
                        </div>
                    </form>
                </div>

                <div class=" container ">
                    <div class=" allMechanics hide" id="mechanics"></div>
                </div>
                <hr style="width:100%;">



                <!-- The Modal -->
                <div id="myModal" class="modal">
                    <!-- Modal content -->
                    <div class=" modal-content ">
                        <div class=" modal-header ">

                            <div class=" row ">
                                <div class=" col-sm-2 ">

                                    <h5> <span class=" close " class=" w3-button w3-display-topright "
                                            onclick="removeModal()">&times;</span> </h5> <br>
                                </div>
                            </div>
                        </div>

                        <div class=" row ">

                            <div class=" col-sm-12 ">
                                <h2> Dear Estemeed Cutomer, You are just a Step away from booking a Mechanic of Your
                                    Choice. Click to confirm or Cancel Your Selection </h2>
                            </div>
                        </div>
                    </div>
                    <div class=" modal-body ">
                        <div class=" row ">
                            <div class=" col-sm-6 ">
                                <button type=" button " id="confirmAppointment"
                                    class=" btn btn-primary btn-lg btn-block  btn btn-primary btn-lg "
                                    onclick="confirmSelection() ">
                                    <h3> Confirm Selection </h3>
                                </button> </div>
                            <div class=" col-sm-6 ">
                                <button type=" button " class=" btn btn-dark btn-lg btn-block " onclick="removeModal()">
                                    <h3> Cancel Selection </h3>
                                </button>
                            </div>
                        </div>

                    </div>

                </div>

            </div>

        </div>
        <div id="id01" class=" w3-modal ">
            <div class=" w3-modal-content w3-animate-zoom w3-card-4 ">
                <header class=" w3-container w3-teal " style=" height: auto; ">
                    <!--/<span
              onclick=" document.getElementById( 'id01' ).style.display='none' "
              class=" w3-button w3-display-topright "
              >&times;</span
            >-->
                    <h1>SUCCESSFUL <span class=" glyphicon glyphicon-ok "></span> <span
                            class=" glyphicon glyphicon-ok "></span>
                    </h1>

                </header>
                <div class=" w3-container " id=" id02 ">
                    <h2>Your Order has been Recieved and Your Mechanic of choice will get to you as soon as possible
                    </h2>
                    <a href=" http://127.0.0.1:8080/ "> <button type=" button " class=" btn btn-primary btn-lg ">
                            <h2>Log Out</h2>
                        </button> </a>
                </div>
                <footer class=" w3-container w3-teal ">
                    <p>
                        <h2>Thank you for Choosing Online Mechanic Finder
                        </h2>
                    </p><br>
                </footer>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(async function () {
            let mechanics = await $.get("/mechanic/mechanics ");
            // console.log(mechanics);
            let images = ["images/mec17.jpeg", "images/image3.jpg", "images/mec17.jpeg",
                "images/image2.jpg", "images/image7.jpg", "images/image6.jpg", "images/mec13.jpeg",
                "images/mec12.jpeg", "images/mec9.jpeg", "images/mec17.jpeg", "images/mec14.jpeg",
                "images/image2.jpg", "images/mec15.jpeg", "images/mec10.jpeg", "images/mec11.jpeg",
                "images/image7.jpg", "images/2mec15.jpeg", "images/mec16.jpeg", "images/mec8.jpeg"

            ]
            let education = [
                ["Bsc in mechanical and mecheatronics", "Expert in solid mechanics(engine expert)"],
                ["Diploma in General car mantainance", "Expert in general car mantainance"],
                ["Certificate in mechanics and meterials",
                    "Expert in engine transmission and mantainance"
                ],
                ["Diploma in general car mantainace", "Expert in general car mantainance"],
                ["Bsc in automotive engineering", "Expert in engine repair and mantrainance"],
                ["Masters in mobile,automotive and transportation",
                "Expert in general car mantainance"],
                ["Bsc in mechanical and mechatronics", "Expert in solid mechanics(engine expert)"],
                ["Diploma in General car mantainance", "expert in general mantainance"],
                ["Certificate in mechnanics and meterials",
                    "expert in engine transmission and mantainance"
                ],
                ["Diploma in general car mantainace", "expert in general car mantainance"],
                ["Bsc in automotive engineering", "expert in engine repair and mantrainance"],
                ["Masters in mobile,automotive and transportation",
                "expert in general car mantainance"],
                ["Bsc in mechanical and mechatronics", "Expert in solid mechanics(engine expert)"],
                ["Diploma in General car mantainance", "expert in general mantainance"],
                ["Certificate in mechnanics and meterials",
                    "expert in engine transmission and mantainance"
                ],
                ["Diploma in general car mantainace", "expert in general car mantainance"],
                ["Bsc in automotive engineering", "expert in engine repair and mantrainance"],
                ["Masters in mobile,automotive and transportation",
                "expert in general car mantainance"],
                ["Masters in mobile,automotive and transportation", "expert in general car mantainance"]
            ]
            let distance = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "1", "2", "3", "4", "5", "6", "7",
                "8", "9", "10"
            ]

            mechanics.map(function (mechanic) {
                mechanic.image = images["0", "1", "2", "3"]

            })
            const buildMap = (mechanics, images) => {
                const map = new Map();
                for (let i = 0; i < mechanics.length; i++) {
                    map.set(mechanics[i], images[i]);
                };
                return map;
            };
            let image = buildMap(mechanics, images);

            // const showEducation = (mechanics, education) => {
            //     const map = new Map();
            //     for (let i = 0; i < mechanics.length; i++) {
            //         map.set(mechanics[i], education[i]);
            //     };
            //     return map;
            // };
            let educational = buildMap(mechanics, education);

            const getDistance = (mechanics, distance) => {

                const map = new Map();
                for (let i = 0; i < mechanics.length; i++) {
                    map.set(mechanics[i], distance[i]);
                };
                return map;

            };
            // console.log(getDistance(mechanics, distance));
            let showDistance = (mechanics, distance) => {
                // console.log(distance);

            }
            showDistance(mechanics, distance)
            const showEducation = (mechanics, education) => {
                const map = new Map();
                for (let i = 0; i < mechanics.length; i++) {
                    map.set(mechanics[i], education[i]);
                };
                return map;
            }
            mechanics.map(function (mechanic) {
                // console.log(educational.get(mechanic));
                $(" #mechanics ").append(`<div id=` + mechanic.phone + `>
        <div class="row myMechanics">
            <div class="col-md-4 names">
                <label>
                    <h4>Name</h4>
                </label>
                <br />` + mechanic.name + `<br />
                <label>
                    <h4>Locality</h4>
                </label><br />` + mechanic.location + `
                <br />
                <label>
                    <h4>Distance:` +
                    getDistance(mechanics, distance).get(mechanic) + `</h4>
                </label><br />
            </div>
            <div class="col-md-4 images">
                <div class=" flip-card ">
                    <div class=" flip-card-inner ">
                        <div class=" flip-card-front ">
                            <img src="` +
                    image.get(mechanic) + `" class=" img-fluid " />
                        </div>
                        <div class=" flip-card-back ">
                            <div class='cont1'>
                                <h2>` + educational.get(mechanic)[0] + ` </h2>
                                <p> ` + educational.get(mechanic)[1] + `
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 ratings">
            <h3> Ratings</h3>
            <span class=" fa fa-star checked ">
            </span>
            <span class=" fa fa-star checked ">
            </span>
            <span class=" fa fa-star checked ">
            </span>
            <span class=" fa fa-star ">
            </span>
            <span class=" fa fa-star ">
            </span>

        </div>
        </div>
        
        <button id="` + mechanic.name + `" type="button" class="btn btn-primary" class="btn btn - primary btn - lg" onclick="modalCall(event)">
            <h3>
                <b> Make An Appointment!
                </b>
            </h3>
        </button>
        <br>
        <br>
        <hr style="height:2px;width:110%;color:red;background-color:gred ">
    </div>`)

            });
        });

        let mechanicName = 'Jon Doe'
        let latitude = 0;
        let longtitude = 0;

        function confirmSelection() {
            document.getElementById('id01').style.display = "block"
        }
        var x = document.getElementById(" location-demo ");

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                x.innerHTML = " Geolocation is not supported by this browser. ";
            }
        }

        function revealMechanics() {
            // console.log(revealMechanics)
            $('#mechanics').addClass('show').removeClass('hide')

        }

        function showPosition(position) {
            let x = document.getElementById('location-demo');
            x.innerHTML = " Latitude: " + position.coords.latitude +
                " <br>Longitude: " + position.coords.longitude;
            latitude = position.coords.latitude;
            longtitude = position.coords.longtitude;
        } // Get the modal var modal = document.getElementById("myModal"); // Get the button that opens the modal // var btn = document.getElementById("myBtn");
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        let button = document.getElementById("")
        onclick = function () {
            modal.style.display = "block"
        }

        function removeModal() {
            let modal = document.getElementById('myModal')
            modal.style.display = "none"
        }

        function modalCall(event) {
            let modal = document.getElementById("myModal");
            modal.style.display = "block"
            mechanicName = event.target.id
        }


        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            let modal = document.getElementById('myModal')
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            let modal = function closeModal() {
                onclick = "removeModal()"
            }
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        const getToken = () => {
            const query = window.location.search
            const urlParams = new URLSearchParams(query)
            const token = urlParams.get('token')
            return token
        }
        let token = getToken()
        let confirmAppointment = document.getElementById("confirmAppointment");
        // console.log(confirmAppointment)
        confirmAppointment.addEventListener("click", async function () {
            let appointment = {
                name: '',
                datetime: new Date(),
                typeOfService: document.getElementById("locationSelection").value,
                carModel: document.getElementById("cars").value,
                briefDescription: document.getElementById("brief").value,
                contacts: '',
                mechanic: mechanicName,
                latitude: latitude,
                longtitude: longtitude,
                token,
            };
            const url = '/appointment'
            const appointmentResult = await $.post(url, appointment);
            console.log(appointmentResult)
        });
    </script>
</body>

</html>